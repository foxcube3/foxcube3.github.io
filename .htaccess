# Safe host and HTTPS enforcement without redirect loops
RewriteEngine On

# Security headers
Header always set Strict-Transport-Security "max-age=31536000; includeSubDomains; preload"
Header always set Content-Security-Policy "upgrade-insecure-requests"
Header always set X-Content-Type-Options "nosniff"
Header always set Referrer-Policy "no-referrer-when-downgrade"

# Redirect to fxcb3.work.gd only if the current host is different
RewriteCond %{HTTP_HOST} !^fxcb3\.work\.gd$ [NC]
RewriteRule ^(.*)$ https://fxcb3.work.gd/$1 [R=301,L]

# Enforce HTTPS when not already using it (keeps current host/path)
RewriteCond %{HTTPS} !=on
RewriteCond %{HTTP:X-Forwarded-Proto} !https
RewriteRule ^ https://%{HTTP_HOST}%{REQUEST_URI} [R=301,L]